FROM fledge:base as base-build

FROM containers.cisco.com/research/dl-docker:latest-cpu

# Copy fledge binaries
COPY --from=base-build /fledge/ /usr/bin/

# Copy fledge job heml template
RUN mkdir -p /fledge/deployment
COPY --from=base-build /tmp/fledge-job/ /fledge/deployment/
RUN rm -f /fledge/deployment/job-agent.yaml.mustache.*
COPY --from=base-build /tmp/fledge-job/job-agent.yaml.mustache.sre /fledge/deployment/job-agent.yaml.mustache

# Install fledge python library
COPY --from=base-build /tmp/*.whl /tmp/
RUN pip3 install /tmp/*.whl && rm -f /tmp/*.whl
